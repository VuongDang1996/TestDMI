<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETCS DMI Simulation - Guide</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            overflow-y: auto;
            padding: 40px;
            align-items: flex-start;
            max-width: 800px;
            margin: 0 auto;
            height: auto;
        }
        h1, h2, h3 { color: var(--etcs-white); }
        h1 { border-bottom: 2px solid var(--etcs-grey); padding-bottom: 10px; }
        h2 { color: var(--etcs-yellow); margin-top: 30px; }
        p, li { line-height: 1.6; color: #ddd; }
        code { background-color: #333; padding: 2px 5px; border-radius: 3px; font-family: monospace; }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: var(--etcs-yellow);
            text-decoration: none;
            font-weight: bold;
        }
        .back-link:hover { text-decoration: underline; }
        .color-box {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 5px;
            border: 1px solid white;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Simulator</a>

    <h1>ETCS DMI Simulation Guide</h1>

    <p>This application simulates the <strong>European Train Control System (ETCS) Driver Machine Interface (DMI)</strong>. It focuses on the Speedometer (Section 8.2) and Symbols (Section 13) of the ERA_ERTMS_015560 specification.</p>

    <h2>1. How to Use the Simulator</h2>
    
    <h3>Control Panel</h3>
    <p>Use the sliders and dropdowns below the DMI to manually inject values:</p>
    <ul>
        <li><strong>Current Speed:</strong> Moves the needle.</li>
        <li><strong>Permitted Speed:</strong> Moves the "Hook" and adjusts the Circular Speed Gauge (CSG) arcs.</li>
        <li><strong>Target Speed:</strong> Sets the target for braking curves (visible in Indication status).</li>
        <li><strong>Mode & Level:</strong> Changes the symbols in Area B7 and C8.</li>
    </ul>

    <h3>Real-world Scenarios</h3>
    <p>Click the buttons in the "Real-world Scenarios" panel to instantly load common situations:</p>
    <ul>
        <li><strong>Normal Driving (FS):</strong> Standard Full Supervision mode.</li>
        <li><strong>Overspeed:</strong> Simulates exceeding the permitted speed (Needle turns Orange).</li>
        <li><strong>Intervention:</strong> Simulates emergency braking (Needle turns Red).</li>
    </ul>

    <h3>Data Recorder</h3>
    <p>You can record your interaction session:</p>
    <ol>
        <li>Enter a <strong>Train Number</strong>.</li>
        <li>Click <strong>üî¥ Record</strong>.</li>
        <li>Interact with the sliders/buttons.</li>
        <li>Click <strong>‚èπ Stop</strong>.</li>
        <li>Click <strong>‚ñ∂ Play</strong> to replay your session.</li>
    </ol>

    <h2>2. DMI Logic (ETCS Rules)</h2>
    
    <h3>The Speedometer (Area B)</h3>
    <p>The speedometer logic follows strict color coding based on the relationship between <code>Current Speed</code> (V_curr) and <code>Permitted Speed</code> (V_perm):</p>
    <ul>
        <li><span class="color-box" style="background: var(--etcs-grey);"></span> <strong>Grey (Normal):</strong> V_curr ‚â§ V_perm.</li>
        <li><span class="color-box" style="background: var(--etcs-orange);"></span> <strong>Orange (Warning):</strong> V_perm < V_curr ‚â§ V_perm + 5 km/h (Warning Limit).</li>
        <li><span class="color-box" style="background: var(--etcs-red);"></span> <strong>Red (Intervention):</strong> V_curr > V_perm + 5 km/h (Intervention Limit).</li>
        <li><span class="color-box" style="background: var(--etcs-yellow);"></span> <strong>Yellow (Indication):</strong> Used when braking to a target. The CSG arc turns yellow from Target Speed to Permitted Speed.</li>
    </ul>

    <h3>The Hook</h3>
    <p>A white "Hook" is always drawn at the <code>Permitted Speed</code> on the outer dial. It indicates the current speed limit.</p>

    <h2>3. Technical Implementation</h2>
    
    <h3>Grid Layout</h3>
    <p>The DMI is built on a strict <strong>640x480 pixel grid</strong> as defined in the spec. We use CSS Absolute Positioning to place Areas A-G exactly where they belong. The container scales using CSS <code>transform: scale()</code> to fit any screen size while maintaining the aspect ratio.</p>

    <h3>HTML5 Canvas Rendering</h3>
    <p>The speedometer is rendered using the HTML5 <code>&lt;canvas&gt;</code> API for high performance. The drawing loop runs on <code>requestAnimationFrame</code> to ensure smooth needle movement.</p>
    <p><strong>Angle Math:</strong> The dial spans from -144¬∞ (0 km/h) to +144¬∞ (Max Scale). We map the speed values to radians to draw the arcs and needle rotation.</p>

    <h3>State Management</h3>
    <p>The application uses a reactive <code>state</code> object in Vanilla JavaScript. When you move a slider, it updates the state, which triggers a UI update and a Canvas redraw. The Recorder simply saves snapshots of this state object over time.</p>

</body>
</html>